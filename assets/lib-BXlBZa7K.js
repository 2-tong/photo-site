import{r as e}from"./rolldown-runtime-B6ubh40S.js";var t=e({tagsById:()=>n,tagsByName:()=>r},1),n={33434:`ExposureTime`,33437:`FNumber`,34850:`ExposureProgram`,34852:`SpectralSensitivity`,34855:`ISOSpeedRatings`,34856:`OECF`,34864:`SensitivityType`,34865:`StandardOutputSensitivity`,34866:`RecommendedExposureIndex`,34867:`ISOSpeed`,34868:`ISOSpeedLatitudeyyy`,34869:`ISOSpeedLatitudezzz`,36864:`ExifVersion`,36867:`DateTimeOriginal`,36868:`DateTimeDigitized`,37121:`ComponentsConfiguration`,37122:`CompressedBitsPerPixel`,37377:`ShutterSpeedValue`,37378:`ApertureValue`,37379:`BrightnessValue`,37380:`ExposureBiasValue`,37381:`MaxApertureValue`,37382:`SubjectDistance`,37383:`MeteringMode`,37384:`LightSource`,37385:`Flash`,37386:`FocalLength`,37396:`SubjectArea`,37500:`MakerNote`,37510:`UserComment`,37520:`SubsecTime`,37521:`SubsecTimeOriginal`,37522:`SubsecTimeDigitized`,40960:`FlashpixVersion`,40961:`ColorSpace`,40962:`PixelXDimension`,40963:`PixelYDimension`,40964:`RelatedSoundFile`,41483:`FlashEnergy`,41484:`SpatialFrequencyResponse`,41486:`FocalPlaneXResolution`,41487:`FocalPlaneYResolution`,41488:`FocalPlaneResolutionUnit`,41492:`SubjectLocation`,41493:`ExposureIndex`,41495:`SensingMethod`,41728:`FileSource`,41729:`SceneType`,41730:`CFAPattern`,41985:`CustomRendered`,41986:`ExposureMode`,41987:`WhiteBalance`,41988:`DigitalZoomRatio`,41989:`FocalLengthIn35mmFilm`,41990:`SceneCaptureType`,41991:`GainControl`,41992:`Contrast`,41993:`Saturation`,41994:`Sharpness`,41995:`DeviceSettingDescription`,41996:`SubjectDistanceRange`,42016:`ImageUniqueID`,42032:`CameraOwnerName`,42033:`BodySerialNumber`,42034:`LensSpecification`,42035:`LensMake`,42036:`LensModel`,42037:`LensSerialNumber`,42240:`Gamma`},r={};for(let e in n)r[n[e]]=Number(e);var i=e({tagsById:()=>a,tagsByName:()=>o},1),a={0:`GPSVersionID`,1:`GPSLatitudeRef`,2:`GPSLatitude`,3:`GPSLongitudeRef`,4:`GPSLongitude`,5:`GPSAltitudeRef`,6:`GPSAltitude`,7:`GPSTimeStamp`,8:`GPSSatellites`,9:`GPSStatus`,10:`GPSMeasureMode`,11:`GPSDOP`,12:`GPSSpeedRef`,13:`GPSSpeed`,14:`GPSTrackRef`,15:`GPSTrack`,16:`GPSImgDirectionRef`,17:`GPSImgDirection`,18:`GPSMapDatum`,19:`GPSDestLatitudeRef`,20:`GPSDestLatitude`,21:`GPSDestLongitudeRef`,22:`GPSDestLongitude`,23:`GPSDestBearingRef`,24:`GPSDestBearing`,25:`GPSDestDistanceRef`,26:`GPSDestDistance`,27:`GPSProcessingMethod`,28:`GPSAreaInformation`,29:`GPSDateStamp`,30:`GPSDifferential`,31:`GPSHPositioningError`},o={};for(let e in a)o[a[e]]=Number(e);var s=e({tagsById:()=>c,tagsByName:()=>l},1),c={254:`NewSubfileType`,255:`SubfileType`,256:`ImageWidth`,257:`ImageLength`,258:`BitsPerSample`,259:`Compression`,262:`PhotometricInterpretation`,263:`Threshholding`,264:`CellWidth`,265:`CellLength`,266:`FillOrder`,270:`ImageDescription`,271:`Make`,272:`Model`,273:`StripOffsets`,274:`Orientation`,277:`SamplesPerPixel`,278:`RowsPerStrip`,279:`StripByteCounts`,280:`MinSampleValue`,281:`MaxSampleValue`,282:`XResolution`,283:`YResolution`,284:`PlanarConfiguration`,288:`FreeOffsets`,289:`FreeByteCounts`,290:`GrayResponseUnit`,291:`GrayResponseCurve`,296:`ResolutionUnit`,305:`Software`,306:`DateTime`,315:`Artist`,316:`HostComputer`,320:`ColorMap`,338:`ExtraSamples`,33432:`Copyright`,269:`DocumentName`,285:`PageName`,286:`XPosition`,287:`YPosition`,292:`T4Options`,293:`T6Options`,297:`PageNumber`,301:`TransferFunction`,317:`Predictor`,318:`WhitePoint`,319:`PrimaryChromaticities`,321:`HalftoneHints`,322:`TileWidth`,323:`TileLength`,324:`TileOffsets`,325:`TileByteCounts`,326:`BadFaxLines`,327:`CleanFaxData`,328:`ConsecutiveBadFaxLines`,330:`SubIFDs`,332:`InkSet`,333:`InkNames`,334:`NumberOfInks`,336:`DotRange`,337:`TargetPrinter`,339:`SampleFormat`,340:`SMinSampleValue`,341:`SMaxSampleValue`,342:`TransferRange`,343:`ClipPath`,344:`XClipPathUnits`,345:`YClipPathUnits`,346:`Indexed`,347:`JPEGTables`,351:`OPIProxy`,400:`GlobalParametersIFD`,401:`ProfileType`,402:`FaxProfile`,403:`CodingMethods`,404:`VersionYear`,405:`ModeNumber`,433:`Decode`,434:`DefaultImageColor`,512:`JPEGProc`,513:`JPEGInterchangeFormat`,514:`JPEGInterchangeFormatLength`,515:`JPEGRestartInterval`,517:`JPEGLosslessPredictors`,518:`JPEGPointTransforms`,519:`JPEGQTables`,520:`JPEGDCTables`,521:`JPEGACTables`,529:`YCbCrCoefficients`,530:`YCbCrSubSampling`,531:`YCbCrPositioning`,532:`ReferenceBlackWhite`,559:`StripRowCounts`,700:`XMP`,32781:`ImageID`,34732:`ImageLayer`,32932:`WangAnnotatio`,33445:`MDFileTag`,33446:`MDScalePixel`,33447:`MDColorTable`,33448:`MDLabName`,33449:`MDSampleInfo`,33450:`MDPrepDate`,33451:`MDPrepTime`,33452:`MDFileUnits`,33550:`ModelPixelScaleTag`,33723:`IPTC`,33918:`INGRPacketDataTag`,33919:`INGRFlagRegisters`,33920:`IrasBTransformationMatrix`,33922:`ModelTiepointTag`,34264:`ModelTransformationTag`,34377:`Photoshop`,34665:`ExifIFD`,34675:`ICCProfile`,34735:`GeoKeyDirectoryTag`,34736:`GeoDoubleParamsTag`,34737:`GeoAsciiParamsTag`,34853:`GPSIFD`,34908:`HylaFAXFaxRecvParams`,34909:`HylaFAXFaxSubAddress`,34910:`HylaFAXFaxRecvTime`,37724:`ImageSourceData`,40965:`InteroperabilityIFD`,42112:`GDAL_METADATA`,42113:`GDAL_NODATA`,50215:`OceScanjobDescription`,50216:`OceApplicationSelector`,50217:`OceIdentificationNumber`,50218:`OceImageLogicCharacteristics`,50706:`DNGVersion`,50707:`DNGBackwardVersion`,50708:`UniqueCameraModel`,50709:`LocalizedCameraModel`,50710:`CFAPlaneColor`,50711:`CFALayout`,50712:`LinearizationTable`,50713:`BlackLevelRepeatDim`,50714:`BlackLevel`,50715:`BlackLevelDeltaH`,50716:`BlackLevelDeltaV`,50717:`WhiteLevel`,50718:`DefaultScale`,50719:`DefaultCropOrigin`,50720:`DefaultCropSize`,50721:`ColorMatrix1`,50722:`ColorMatrix2`,50723:`CameraCalibration1`,50724:`CameraCalibration2`,50725:`ReductionMatrix1`,50726:`ReductionMatrix2`,50727:`AnalogBalance`,50728:`AsShotNeutral`,50729:`AsShotWhiteXY`,50730:`BaselineExposure`,50731:`BaselineNoise`,50732:`BaselineSharpness`,50733:`BayerGreenSplit`,50734:`LinearResponseLimit`,50735:`CameraSerialNumber`,50736:`LensInfo`,50737:`ChromaBlurRadius`,50738:`AntiAliasStrength`,50740:`DNGPrivateData`,50741:`MakerNoteSafety`,50778:`CalibrationIlluminant1`,50779:`CalibrationIlluminant2`,50780:`BestQualityScale`,50784:`AliasLayerMetadata`},l={};for(let e in c)l[c[e]]=Number(e);function u(e,t=`utf8`){return new TextDecoder(t).decode(e)}var d=new TextEncoder;function f(e){return d.encode(e)}var p=1024*8,m=(()=>{let e=new Uint8Array(4),t=new Uint32Array(e.buffer);return!((t[0]=1)&e[0])})(),h={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array},g=class e{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(t=p,n={}){let r=!1;typeof t==`number`?t=new ArrayBuffer(t):(r=!0,this.lastWrittenByte=t.byteLength);let i=n.offset?n.offset>>>0:0,a=t.byteLength-i,o=i;(ArrayBuffer.isView(t)||t instanceof e)&&(t.byteLength!==t.buffer.byteLength&&(o=t.byteOffset+i),t=t.buffer),r?this.lastWrittenByte=a:this.lastWrittenByte=0,this.buffer=t,this.length=a,this.byteLength=a,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,a),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){let e=this._marks.pop();if(e===void 0)throw Error(`Mark stack empty`);return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){let t=(this.offset+e)*2,n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=t,this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,`uint8`)}readArray(e,t){let n=h[t].BYTES_PER_ELEMENT*e,r=this.byteOffset+this.offset,i=this.buffer.slice(r,r+n);if(this.littleEndian===m&&t!==`uint8`&&t!==`int8`){let e=new Uint8Array(this.buffer.slice(r,r+n));e.reverse();let i=new h[t](e.buffer);return this.offset+=n,i.reverse(),i}let a=new h[t](i);return this.offset+=n,a}readInt16(){let e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){let e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){let e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){let e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){let e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){let e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){let e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){let e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t=``;for(let n=0;n<e;n++)t+=this.readChar();return t}readUtf8(e=1){return u(this.readBytes(e))}decodeText(e=1,t=`utf8`){return u(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(f(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}};function _(e){if(e.compression!==1)throw Error(`missing mandatory StripByteCounts field in compressed image`);let t=e.rowsPerStrip*e.width*e.samplesPerPixel*(e.bitsPerSample/8);return Array(e.stripOffsets.length).fill(t)}function v(e,t,n){let r=0;for(;r<e.length;){for(let i=n;i<t*n;i+=n)for(let t=0;t<n;t++)e[r+i+t]=e[r+i+t]+e[r+i-(n-t)]&255;r+=t*n}}function y(e,t,n){let r=0;for(;r<e.length;){for(let i=n;i<t*n;i+=n)for(let t=0;t<n;t++)e[r+i+t]=e[r+i+t]+e[r+i-(n-t)]&65535;r+=t*n}}var b={standard:s,exif:t,gps:i},x=class{kind;data;fields;exif;gps;_hasMap;_map;constructor(e){if(!e)throw Error(`missing kind`);this.data=new Uint8Array,this.fields=new Map,this.kind=e,this._hasMap=!1,this._map={}}get(e){if(typeof e==`number`)return this.fields.get(e);if(typeof e==`string`)return this.fields.get(b[this.kind].tagsByName[e]);throw Error(`expected a number or string`)}get map(){if(!this._hasMap){let e=b[this.kind].tagsById;for(let t of this.fields.keys())e[t]&&(this._map[e[t]]=this.fields.get(t));this._hasMap=!0}return this._map}},S=new Map([[1,[1,T]],[2,[1,ee]],[3,[2,te]],[4,[4,E]],[5,[8,D]],[6,[1,O]],[7,[1,T]],[8,[2,k]],[9,[4,ne]],[10,[8,A]],[11,[4,j]],[12,[8,M]]]);function C(e,t){let n=S.get(e);if(!n)throw Error(`type not found: ${e}`);return n[0]*t}function w(e,t,n){let r=S.get(t);if(!r)throw Error(`type not found: ${t}`);return r[1](e,n)}function T(e,t){if(t===1)return e.readUint8();let n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.readUint8();return n}function ee(e,t){let n=[],r=``;for(let i=0;i<t;i++){let t=String.fromCharCode(e.readUint8());t===`\0`?(n.push(r),r=``):r+=t}return n.length===1?n[0]:n}function te(e,t){if(t===1)return e.readUint16();let n=new Uint16Array(t);for(let r=0;r<t;r++)n[r]=e.readUint16();return n}function E(e,t){if(t===1)return e.readUint32();let n=new Uint32Array(t);for(let r=0;r<t;r++)n[r]=e.readUint32();return n}function D(e,t){if(t===1)return e.readUint32()/e.readUint32();let n=Array(t);for(let r=0;r<t;r++)n[r]=e.readUint32()/e.readUint32();return n}function O(e,t){if(t===1)return e.readInt8();let n=new Int8Array(t);for(let r=0;r<t;r++)n[r]=e.readInt8();return n}function k(e,t){if(t===1)return e.readInt16();let n=new Int16Array(t);for(let r=0;r<t;r++)n[r]=e.readInt16();return n}function ne(e,t){if(t===1)return e.readInt32();let n=new Int32Array(t);for(let r=0;r<t;r++)n[r]=e.readInt32();return n}function A(e,t){if(t===1)return e.readInt32()/e.readInt32();let n=Array(t);for(let r=0;r<t;r++)n[r]=e.readInt32()/e.readInt32();return n}function j(e,t){if(t===1)return e.readFloat32();let n=new Float32Array(t);for(let r=0;r<t;r++)n[r]=e.readFloat32();return n}function M(e,t){if(t===1)return e.readFloat64();let n=new Float64Array(t);for(let r=0;r<t;r++)n[r]=e.readFloat64();return n}var re=256,N=257,P=258,F=9,I=[];function L(){if(I.length===0){for(let e=0;e<256;e++)I.push([e]);let e=[];for(let t=256;t<4096;t++)I.push(e)}}var R=[511,1023,2047,4095],z=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095],B=class{stripArray;nextData=0;nextBits=0;bytePointer=0;tableLength=P;currentBitLength=F;outData;constructor(e){this.stripArray=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.outData=new g(e.byteLength),this.initializeTable()}decode(){let e=0,t=0;for(;(e=this.getNextCode())!==N;)if(e===re){if(this.initializeTable(),e=this.getNextCode(),e===N)break;this.writeString(this.stringFromCode(e)),t=e}else if(this.isInTable(e))this.writeString(this.stringFromCode(e)),this.addStringToTable(this.stringFromCode(t).concat(this.stringFromCode(e)[0])),t=e;else{let n=this.stringFromCode(t).concat(this.stringFromCode(t)[0]);this.writeString(n),this.addStringToTable(n),t=e}let n=this.outData.toArray();return new DataView(n.buffer,n.byteOffset,n.byteLength)}initializeTable(){L(),this.tableLength=P,this.currentBitLength=F}writeString(e){this.outData.writeBytes(e)}stringFromCode(e){return I[e]}isInTable(e){return e<this.tableLength}addStringToTable(e){if(I[this.tableLength++]=e,I.length>4096)throw I=[],Error(`LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).`);this.tableLength===z[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);let e=this.nextData>>this.nextBits-this.currentBitLength&R[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:e}};function V(e){return new B(e).decode()}var ie=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/,ae=class extends x{constructor(){super(`standard`)}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let e=new Date,t=ie.exec(this.dateTime);if(t===null)throw Error(`invalid dateTime: ${this.dateTime}`);return e.setFullYear(Number(t[1]),Number(t[2])-1,Number(t[3])),e.setHours(Number(t[4]),Number(t[5]),Number(t[6])),e}get newSubfileType(){return this.get(`NewSubfileType`)}get imageWidth(){return this.get(`ImageWidth`)}get imageLength(){return this.get(`ImageLength`)}get bitsPerSample(){let e=this.get(`BitsPerSample`);return e&&typeof e!=`number`?e[0]:e}get alpha(){let e=this.extraSamples;return e?e[0]!==0:!1}get associatedAlpha(){let e=this.extraSamples;return e?e[0]===1:!1}get extraSamples(){return H(this.get(`ExtraSamples`))}get compression(){return this.get(`Compression`)||1}get type(){return this.get(`PhotometricInterpretation`)}get fillOrder(){return this.get(`FillOrder`)||1}get documentName(){return this.get(`DocumentName`)}get imageDescription(){return this.get(`ImageDescription`)}get stripOffsets(){return H(this.get(`StripOffsets`))}get orientation(){return this.get(`Orientation`)}get samplesPerPixel(){return this.get(`SamplesPerPixel`)||1}get rowsPerStrip(){return this.get(`RowsPerStrip`)||2**32-1}get stripByteCounts(){return H(this.get(`StripByteCounts`))}get minSampleValue(){return this.get(`MinSampleValue`)||0}get maxSampleValue(){return this.get(`MaxSampleValue`)||2**this.bitsPerSample-1}get xResolution(){return this.get(`XResolution`)}get yResolution(){return this.get(`YResolution`)}get planarConfiguration(){return this.get(`PlanarConfiguration`)||1}get resolutionUnit(){return this.get(`ResolutionUnit`)||2}get dateTime(){return this.get(`DateTime`)}get predictor(){return this.get(`Predictor`)||1}get sampleFormat(){return H(this.get(`SampleFormat`)||1)[0]}get sMinSampleValue(){return this.get(`SMinSampleValue`)||this.minSampleValue}get sMaxSampleValue(){return this.get(`SMaxSampleValue`)||this.maxSampleValue}get palette(){let e=2**this.bitsPerSample,t=this.get(`ColorMap`);if(!t)return;if(t.length!==3*e)throw Error(`ColorMap size must be ${e}`);let n=[];for(let r=0;r<e;r++)n.push([t[r],t[r+e],t[r+2*e]]);return n}get tileWidth(){return this.get(`TileWidth`)}get tileHeight(){return this.get(`TileLength`)}get tileOffsets(){return H(this.get(`TileOffsets`))}get tileByteCounts(){return H(this.get(`TileByteCounts`))}get tiled(){return this.tileWidth!==void 0&&this.tileHeight!==void 0&&this.tileOffsets!==void 0&&this.tileByteCounts!==void 0}};function H(e){return typeof e==`number`?[e]:e}var U=Uint8Array,W=Uint16Array,oe=Int32Array,se=new U([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ce=new U([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),le=new U([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ue=function(e,t){for(var n=new W(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];for(var i=new oe(n[30]),r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)i[a]=a-n[r]<<5|r;return{b:n,r:i}},de=ue(se,2),fe=de.b,pe=de.r;fe[28]=258,pe[258]=28;var me=ue(ce,0),he=me.b;me.r;for(var G=new W(32768),K=0;K<32768;++K){var q=(K&43690)>>1|(K&21845)<<1;q=(q&52428)>>2|(q&13107)<<2,q=(q&61680)>>4|(q&3855)<<4,G[K]=((q&65280)>>8|(q&255)<<8)>>1}for(var J=(function(e,t,n){for(var r=e.length,i=0,a=new W(t);i<r;++i)e[i]&&++a[e[i]-1];var o=new W(t);for(i=1;i<t;++i)o[i]=o[i-1]+a[i-1]<<1;var s;if(n){s=new W(1<<t);var c=15-t;for(i=0;i<r;++i)if(e[i])for(var l=i<<4|e[i],u=t-e[i],d=o[e[i]-1]++<<u,f=d|(1<<u)-1;d<=f;++d)s[G[d]>>c]=l}else for(s=new W(r),i=0;i<r;++i)e[i]&&(s[i]=G[o[e[i]-1]++]>>15-e[i]);return s}),Y=new U(288),K=0;K<144;++K)Y[K]=8;for(var K=144;K<256;++K)Y[K]=9;for(var K=256;K<280;++K)Y[K]=7;for(var K=280;K<288;++K)Y[K]=8;for(var ge=new U(32),K=0;K<32;++K)ge[K]=5;var _e=J(Y,9,1),ve=J(ge,5,1),X=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Z=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(t&7)&n},ye=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)},be=function(e){return(e+7)/8|0},xe=function(e,t,n){return(t==null||t<0)&&(t=0),(n==null||n>e.length)&&(n=e.length),new U(e.subarray(t,n))},Se=[`unexpected EOF`,`invalid block type`,`invalid length/literal`,`invalid distance`,`stream finished`,`no stream handler`,,`no callback`,`invalid UTF-8 data`,`extra field too long`,`date not in range 1980-2099`,`filename too long`,`stream finishing`,`invalid zip data`],Q=function(e,t,n){var r=Error(t||Se[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,Q),!n)throw r;return r},Ce=function(e,t,n,r){var i=e.length,a=r?r.length:0;if(!i||t.f&&!t.l)return n||new U(0);var o=!n,s=o||t.i!=2,c=t.i;o&&(n=new U(i*3));var l=function(e){var t=n.length;if(e>t){var r=new U(Math.max(t*2,e));r.set(n),n=r}},u=t.f||0,d=t.p||0,f=t.b||0,p=t.l,m=t.d,h=t.m,g=t.n,_=i*8;do{if(!p){u=Z(e,d,1);var v=Z(e,d+1,3);if(d+=3,v)if(v==1)p=_e,m=ve,h=9,g=5;else if(v==2){var y=Z(e,d,31)+257,b=Z(e,d+10,15)+4,x=y+Z(e,d+5,31)+1;d+=14;for(var S=new U(x),C=new U(19),w=0;w<b;++w)C[le[w]]=Z(e,d+w*3,7);d+=b*3;for(var T=X(C),ee=(1<<T)-1,te=J(C,T,1),w=0;w<x;){var E=te[Z(e,d,ee)];d+=E&15;var D=E>>4;if(D<16)S[w++]=D;else{var O=0,k=0;for(D==16?(k=3+Z(e,d,3),d+=2,O=S[w-1]):D==17?(k=3+Z(e,d,7),d+=3):D==18&&(k=11+Z(e,d,127),d+=7);k--;)S[w++]=O}}var ne=S.subarray(0,y),A=S.subarray(y);h=X(ne),g=X(A),p=J(ne,h,1),m=J(A,g,1)}else Q(1);else{var D=be(d)+4,j=e[D-4]|e[D-3]<<8,M=D+j;if(M>i){c&&Q(0);break}s&&l(f+j),n.set(e.subarray(D,M),f),t.b=f+=j,t.p=d=M*8,t.f=u;continue}if(d>_){c&&Q(0);break}}s&&l(f+131072);for(var re=(1<<h)-1,N=(1<<g)-1,P=d;;P=d){var O=p[ye(e,d)&re],F=O>>4;if(d+=O&15,d>_){c&&Q(0);break}if(O||Q(2),F<256)n[f++]=F;else if(F==256){P=d,p=null;break}else{var I=F-254;if(F>264){var w=F-257,L=se[w];I=Z(e,d,(1<<L)-1)+fe[w],d+=L}var R=m[ye(e,d)&N],z=R>>4;R||Q(3),d+=R&15;var A=he[z];if(z>3){var L=ce[z];A+=ye(e,d)&(1<<L)-1,d+=L}if(d>_){c&&Q(0);break}s&&l(f+131072);var B=f+I;if(f<A){var V=a-A,ie=Math.min(A,B);for(V+f<0&&Q(3);f<ie;++f)n[f]=r[V+f]}for(;f<B;++f)n[f]=n[f-A]}}t.l=p,t.p=P,t.b=f,t.f=u,p&&(u=1,t.m=h,t.d=m,t.n=g)}while(!u);return f!=n.length&&o?xe(n,0,f):n.subarray(0,f)},we=new U(0),Te=function(e){(e[0]!=31||e[1]!=139||e[2]!=8)&&Q(6,`invalid gzip data`);var t=e[3],n=10;t&4&&(n+=(e[10]|e[11]<<8)+2);for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(t&2)},Ee=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},De=function(e,t){return((e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31)&&Q(6,`invalid zlib data`),(e[1]>>5&1)==+!t&&Q(6,`invalid zlib data: `+(e[1]&32?`need`:`unexpected`)+` dictionary`),(e[1]>>3&4)+2};function Oe(e,t){return Ce(e,{i:2},t&&t.out,t&&t.dictionary)}function ke(e,t){var n=Te(e);return n+8>e.length&&Q(6,`invalid gzip data`),Ce(e.subarray(n,-8),{i:2},t&&t.out||new U(Ee(e)),t&&t.dictionary)}function Ae(e,t){return Ce(e.subarray(De(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}function je(e,t){return e[0]==31&&e[1]==139&&e[2]==8?ke(e,t):(e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31?Oe(e,t):Ae(e,t)}var Me=typeof TextDecoder<`u`&&new TextDecoder;try{Me.decode(we,{stream:!0})}catch{}function Ne(e){let t=je(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));return new DataView(t.buffer,t.byteOffset,t.byteLength)}var Pe={ignoreImageData:!1},Fe=class e extends g{_nextIFD;constructor(e){super(e),this._nextIFD=0}get isMultiPage(){let e=0;for(this.decodeHeader();this._nextIFD;)if(e++,this.decodeIFD({ignoreImageData:!0},!0),e===2)return!0;if(e===1)return!1;throw $(`ifdCount`,e)}get pageCount(){let e=0;for(this.decodeHeader();this._nextIFD;)e++,this.decodeIFD({ignoreImageData:!0},!0);if(e>0)return e;throw $(`ifdCount`,e)}decode(e={}){let{pages:t}=e;Le(t);let n=t?Math.max(...t):1/0;e={...Pe,...e};let r=[];this.decodeHeader();let i=0;for(;this._nextIFD;){if(t){if(t.includes(i)?r.push(this.decodeIFD(e,!0)):this.decodeIFD({ignoreImageData:!0},!0),i===n)break}else r.push(this.decodeIFD(e,!0));i++}if(i<n&&n!==1/0)throw RangeError(`Index ${n} is out of bounds. The stack only contains ${i} images.`);return r}decodeHeader(){let e=this.readUint16();if(e===18761)this.setLittleEndian();else if(e===19789)this.setBigEndian();else throw Error(`invalid byte order: 0x${e.toString(16)}`);if(this.readUint16()!==42)throw Error(`not a TIFF file`);this._nextIFD=this.readUint32()}decodeIFD(e,t){this.seek(this._nextIFD);let n;if(t)n=new ae;else{if(!e.kind)throw Error(`kind is missing`);n=new x(e.kind)}let r=this.readUint16();for(let e=0;e<r;e++)this.decodeIFDEntry(n);if(!e.ignoreImageData){if(!(n instanceof ae))throw Error(`must be a tiff ifd`);this.decodeImageData(n)}return this._nextIFD=this.readUint32(),n}decodeIFDEntry(e){let t=this.offset,n=this.readUint16(),r=this.readUint16(),i=this.readUint32();if(r<1||r>12){this.skip(4);return}C(r,i)>4&&this.seek(this.readUint32());let a=w(this,r,i);if(e.fields.set(n,a),n===34665||n===34853){let t=this.offset,r=`exif`;n===34665?r=`exif`:n===34853&&(r=`gps`),this._nextIFD=a,e[r]=this.decodeIFD({kind:r,ignoreImageData:!0},!1),this.offset=t}this.seek(t),this.skip(12)}decodeImageData(e){let t=e.orientation;if(t&&t!==1)throw $(`orientation`,t);switch(e.type){case 0:case 1:case 2:case 3:e.tiled?this.readTileData(e):this.readStripData(e);break;default:throw $(`image type`,e.type)}if(this.applyPredictor(e),this.convertAlpha(e),e.bitsPerSample===1&&this.split1BitData(e),e.type===0){let t=2**e.bitsPerSample-1;for(let n=0;n<e.data.length;n++)e.data[n]=t-e.data[n]}}split1BitData(e){let{imageWidth:t,imageLength:n,samplesPerPixel:r}=e,i=new Uint8Array(n*t*r),a=Math.ceil(t*r/8),o=0;for(let s=0;s<n;s++){let n=s*a;for(let a=0;a<t*r;a++){let t=n+Math.floor(a/8),r=7-a%8,s=e.data[t]>>r&1;i[o++]=s}}e.data=i}static uncompress(e,t=1){switch(t){case 1:return e;case 5:return V(e);case 8:case 32946:return Ne(e);case 2:throw $(`Compression`,`CCITT Group 3`);case 32773:throw $(`Compression`,`PackBits`);default:throw $(`Compression`,t)}}createSampleReader(e,t,n){if(t===8||t===1)return(e,t)=>e.getUint8(t);if(t===16)return(e,t)=>e.getUint16(2*t,n);if(t===32&&e===3)return(e,t)=>e.getFloat32(4*t,n);if(t===64&&e===3)return(e,t)=>e.getFloat64(8*t,n);throw $(`bitDepth`,t)}readStripData(t){let n=t.width,r=t.height,i=t.bitsPerSample===1?Math.ceil(n*t.samplesPerPixel/8)*r:n*t.samplesPerPixel*r,a=t.stripOffsets,o=t.stripByteCounts||_(t),s=this.isLittleEndian(),c=t.bitsPerSample===1?Math.ceil(n*t.samplesPerPixel/8)*t.rowsPerStrip:n*t.samplesPerPixel*t.rowsPerStrip,l=this.createSampleReader(t.sampleFormat,t.bitsPerSample,s),u=Ie(i,t.bitsPerSample,t.sampleFormat),d=0;for(let n=0;n<a.length;n++){let r=new DataView(this.buffer,this.byteOffset+a[n],o[n]),s=e.uncompress(r,t.compression),f=Math.min(c,i-d);for(let e=0;e<f;++e){let t=l(s,e);u[d+e]=t}d+=f}t.data=u}readTileData(t){if(!t.tileWidth||!t.tileHeight)return;let n=t.width,r=t.height,i=t.bitsPerSample===1?Math.ceil(n*t.samplesPerPixel/8)*r:n*r*t.samplesPerPixel,a=t.tileWidth,o=t.tileHeight,s=Math.ceil(n/a),c=Math.ceil(r/o),l=t.tileOffsets,u=t.tileByteCounts,d=this.isLittleEndian(),f=this.createSampleReader(t.sampleFormat,t.bitsPerSample,d),p=Ie(i,t.bitsPerSample,t.sampleFormat);for(let i=0;i<s;++i)for(let d=0;d<c;++d){let c=d*s+i,m=new DataView(this.buffer,this.byteOffset+l[c],u[c]),h=e.uncompress(m,t.compression);if(t.bitsPerSample===1){let e=Math.ceil(n/8),t=Math.ceil(a/8);for(let n=0;n<o&&d*o+n<r;n++){let r=d*o+n,s=n*t,c=r*e+Math.floor(i*a/8),l=Math.min(t,e-Math.floor(i*a/8));for(let e=0;e<l;e++)p[c+e]=f(h,s+e)}}else for(let e=0;e<o;e++)for(let s=0;s<a;s++){let c=i*a+s,l=d*o+e;if(c>=n||l>=r)continue;let u=f(h,e*a+s),m=(l*n+c)*t.samplesPerPixel;p[m]=u}}t.data=p}applyPredictor(e){let t=e.bitsPerSample;switch(e.predictor){case 1:break;case 2:if(t===8)v(e.data,e.width,e.components);else if(t===16)y(e.data,e.width,e.components);else throw Error(`Horizontal differencing is only supported for images with a bit depth of ${t}`);break;default:throw Error(`invalid predictor: ${e.predictor}`)}}convertAlpha(e){if(e.alpha&&e.associatedAlpha){let{data:t,components:n,maxSampleValue:r}=e;for(let e=0;e<t.length;e+=n){let i=t[e+n-1];for(let a=0;a<n-1;a++)t[e+a]=Math.round(t[e+a]*r/i)}}}};function Ie(e,t,n){if(t===8||t===1)return new Uint8Array(e);if(t===16)return new Uint16Array(e);if(t===32&&n===3)return new Float32Array(e);if(t===64&&n===3)return new Float64Array(e);throw $(`bit depth / sample format`,`${t} / ${n}`)}function $(e,t){return Error(`Unsupported ${e}: ${t}`)}function Le(e){if(e){for(let t of e)if(t<0||!Number.isInteger(t))throw RangeError(`Index ${t} is invalid. Must be a positive integer.`)}}function Re(e,t){return new Fe(e).decode(t)}function ze(e){return new Fe(e).isMultiPage}function Be(e){return new Fe(e).pageCount}var Ve={exif:n,gps:a,standard:c};export{ae as TiffIfd,Re as decode,ze as isMultiPage,Be as pageCount,Ve as tagNames};